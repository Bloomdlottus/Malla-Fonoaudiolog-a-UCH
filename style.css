/* style.css */
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  margin: 2rem;
  background-color: #f9f9f9;
  color: #222;
}

h1 {
  text-align: center;
  margin-bottom: 1.5rem;
  color: #333;
}

.mermaid {
  background-color: #fff;
  padding: 1rem;
  border: 1px solid #ddd;
  border-radius: 8px;
  overflow-x: auto;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}
// script.js

const data = [
  // ... (semestres y ramos ya definidos, sin cambios)
];

const malla = document.getElementById("malla");
const colores = ["#e74c3c", "#3498db", "#27ae60", "#f39c12", "#8e44ad", "#16a085", "#d35400"];
const estadoRamos = {};

function crearMalla() {
  data.forEach((semestre, idx) => {
    const col = document.createElement("div");
    col.className = "semestre";
    const titulo = document.createElement("h3");
    titulo.textContent = semestre.semestre;
    col.appendChild(titulo);

    semestre.ramos.forEach((ramo, i) => {
      const div = document.createElement("div");
      div.className = "ramo locked";
      div.textContent = ramo.nombre;
      div.style.backgroundColor = colores[(i + idx) % colores.length];
      div.onclick = () => toggleRamo(ramo.nombre);
      col.appendChild(div);
      estadoRamos[ramo.nombre] = {
        el: div,
        aprobado: false,
        prerequisitos: ramo.prerequisitos,
      };
    });

    malla.appendChild(col);
  });
  cargarProgreso();
  validarEstado();
}

function toggleRamo(nombre) {
  const ramo = estadoRamos[nombre];
  if (ramo.el.classList.contains("locked")) return;
  ramo.aprobado = !ramo.aprobado;
  ramo.el.classList.toggle("done", ramo.aprobado);
  guardarProgreso();
  validarEstado();
}

function validarEstado() {
  Object.keys(estadoRamos).forEach((nombre) => {
    const ramo = estadoRamos[nombre];
    const requisitosCumplidos = ramo.prerequisitos.every(
      (req) => estadoRamos[req] && estadoRamos[req].aprobado
    );
    ramo.el.classList.toggle("locked", !requisitosCumplidos);
  });
}

function resetMalla() {
  Object.values(estadoRamos).forEach((ramo) => {
    ramo.aprobado = false;
    ramo.el.classList.remove("done");
  });
  localStorage.removeItem("progresoMalla");
  validarEstado();
}

function exportPDF() {
  window.print();
}

function guardarProgreso() {
  const progreso = {};
  Object.keys(estadoRamos).forEach((nombre) => {
    progreso[nombre] = estadoRamos[nombre].aprobado;
  });
  localStorage.setItem("progresoMalla", JSON.stringify(progreso));
}

function cargarProgreso() {
  const progreso = JSON.parse(localStorage.getItem("progresoMalla")) || {};
  Object.entries(progreso).forEach(([nombre, aprobado]) => {
    if (estadoRamos[nombre]) {
      estadoRamos[nombre].aprobado = aprobado;
      if (aprobado) estadoRamos[nombre].el.classList.add("done");
    }
  });
}

crearMalla();
